- name: setup kuberntes gpg key
  shell: curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
- name: set up kubernetes repository
  lineinfile: dest=/etc/apt/sources.list.d/kubernetes.list line='deb http://apt.kubernetes.io/ kubernetes-xenial main' state=present create=yes
- name: install prerequisites
  apt: name={{item}} state=latest
  with_items:
  - apt-transport-https
  - ca-certificates
- name: install docker gpg key
  command: apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
- name: set up docker repository
  lineinfile: dest=/etc/apt/sources.list.d/docker.list line='deb https://apt.dockerproject.org/repo ubuntu-xenial main' state=present create=yes
- name: update apt sources
  apt: name={{item}} update_cache=yes
  with_items:
  - docker-engine
  - kubelet
  - kubeadm
  - kubectl
  - kubernetes-cni
- name: fix /etc/hosts hostname
  lineinfile: dest=/etc/hosts line='{{ansible_enp0s8.ipv4.address}} {{inventory_hostname}}.local {{inventory_hostname}}'
- name: fix /etc/hostname
  lineinfile: dest=/etc/hostname regexp='.*' line='{{inventory_hostname}}'
- name: update running hostname
  command: 'hostname {{inventory_hostname}}'
